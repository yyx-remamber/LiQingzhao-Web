<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æŒä¸Šæ˜“å®‰ - å®Œç¾è§’åº¦ç‰ˆ</title>
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; background-color: #000; font-family: 'Microsoft YaHei', sans-serif; }
        
        #app-container {
            position: relative; width: 100%; max-width: 580px; height: 100%; margin: 0 auto;
            background-image: url('background.png'); background-size: cover; background-position: center;
        }

        #scale-wrapper {
            position: relative; width: 100%; height: 100%;
            transform: scale(0.85); transform-origin: center 60%; 
        }

        model-viewer { width: 100%; height: 115%; outline: none; }

        .hitbox-layer {
            position: absolute; top: 5%; left: 0; width: 100%; height: 100%; z-index: 20; pointer-events: none; 
        }

        .hitbox {
            position: absolute; pointer-events: auto; cursor: pointer;
            background-color: rgba(255, 0, 0, 0); /* è°ƒè¯•æ¨¡å¼ï¼šçº¢è‰² */
           // border: 1px solid yellow;
        }

        /* çƒ­åŒºå®šä½ */
        #hit-head { top: 15%; left: 20%; width: 60%; height: 20%; }
        #hit-mouth { top: 43%; left: 42%; width: 16%; height: 8%; z-index: 25; }
        #hit-hand-right { top: 50%; left: 65%; width: 25%; height: 20%; }
        #hit-arm-left { top: 50%; left: 10%; width: 25%; height: 20%; }
        #hit-body { top: 50%; left: 35%; width: 30%; height: 40%; }

        #dialog-box {
            position: absolute; top: 17%; left: 50%; transform: translateX(-50%);
            width: 80%; background: rgba(0, 20, 40, 0.85); border: 1px solid #00e5ff; color: #fff; 
            padding: 15px; border-radius: 12px; text-align: center; display: none; z-index: 30; pointer-events: none;
        }

        #controls { position: absolute; bottom: 40px; width: 100%; text-align: center; z-index: 30; }
        .cyber-btn { background: linear-gradient(45deg, #00e5ff, #2979ff); border: none; border-radius: 50px; padding: 12px 40px; color: white; font-weight: bold; box-shadow: 0 4px 15px rgba(0, 229, 255, 0.4); }
    </style>
</head>
<body>

<div id="app-container">
    <div id="dialog-box">ä½ å¥½å‘€ï¼Œæˆ‘æ˜¯èµ›åšæ˜“å®‰ï¼</div>

    <div id="scale-wrapper">
        <!-- 
           æ³¨æ„ï¼šè¿™é‡Œå»æ‰äº† rotationï¼Œä¹Ÿä¸éœ€è¦æ‰‹åŠ¨å†™ min/max/orbit
           ä¸€åˆ‡äº¤ç”±ä¸‹é¢çš„ JS è‡ªåŠ¨æ§åˆ¶ï¼Œé˜²æ­¢å†²çª
        -->
        <model-viewer 
            id="model"
            src="model.glb" 
            alt="Li Qingzhao" 
            camera-controls 
            disable-zoom 
            disable-pan
            shadow-intensity="1"
            environment-image="neutral"
            interpolation-decay="200"
        >
        </model-viewer>

        <div class="hitbox-layer">
            <div id="hit-head" class="hitbox" onclick="interact('head')"></div>
            <div id="hit-mouth" class="hitbox" onclick="interact('mouth')"></div>
            <div id="hit-hand-right" class="hitbox" onclick="interact('hand_right')"></div>
            <div id="hit-arm-left" class="hitbox" onclick="interact('arm_left')"></div>
            <div id="hit-body" class="hitbox" onclick="interact('body')"></div>
        </div>
    </div>

    <div id="controls">
        <button class="cyber-btn" onclick="sayHello()">ğŸ‘‹ æ‰“ä¸ªæ‹›å‘¼</button>
    </div>
</div>

<script>
    // ==========================================
    // ğŸ”§ğŸ”§ğŸ”§ æ ¸å¿ƒé…ç½®åŒº (åªæ”¹è¿™é‡Œï¼) ğŸ”§ğŸ”§ğŸ”§
    // ==========================================
    
    // å¦‚æœäººç‰©åˆå§‹å‘å³åï¼ŒæŠŠè¿™ä¸ªæ”¹æˆ 90
    // å¦‚æœäººç‰©åˆå§‹å‘å·¦åï¼ŒæŠŠè¿™ä¸ªæ”¹æˆ -90
    // å¦‚æœæ˜¯èƒŒé¢ï¼Œæ”¹æˆ 180
    const BASE_ANGLE = 90; 

    // ==========================================
    
    const dialogBox = document.getElementById('dialog-box');
    const modelViewer = document.getElementById('model');
    let hideTimer = null;

    // --- åˆå§‹åŒ–å‡½æ•°ï¼šè‡ªåŠ¨è®¾ç½®è§’åº¦å’Œé™åˆ¶ ---
    function initCamera() {
        // 1. è®¾ç½®åˆå§‹è§†è§’
        modelViewer.cameraOrbit = `${BASE_ANGLE}deg 75deg 105%`;
        
        // 2. åŠ¨æ€è®¡ç®—å·¦å³é™åˆ¶ (åŸºå‡†è§’åº¦ Â± 45åº¦)
        // è¿™æ ·æ— è®ºåŸºå‡†æ˜¯å¤šå°‘ï¼Œç”¨æˆ·éƒ½åªèƒ½å·¦å³è½¬45åº¦
        const minAngle = BASE_ANGLE - 45;
        const maxAngle = BASE_ANGLE + 45;
        
        modelViewer.minCameraOrbit = `${minAngle}deg 60deg auto`;
        modelViewer.maxCameraOrbit = `${maxAngle}deg 95deg auto`;
        
        // 3. å¼ºåˆ¶æ›´æ–°ä¸€æ¬¡
        modelViewer.updateFraming();
    }

    // æ¨¡å‹åŠ è½½å®Œæˆåï¼Œç«‹å³æ‰§è¡Œåˆå§‹åŒ–
    modelViewer.addEventListener('load', initCamera);

    // --- äº¤äº’æ–‡æ¡ˆ ---
    const scripts = {
        head: ["å“å‘€ï¼è½»ç‚¹ç¢°ï¼Œè¿™å¯æ˜¯ç« ä¸˜é¾™å±±æ–‡åŒ–çš„è›‹å£³é»‘é™¶ï¼Œè–„å¦‚è‰ç¿¼ï¼Œç¢äº†å¯å°±å†éš¾çƒ§åˆ¶äº†ï¼","å‘å‹ä¸èƒ½ä¹±ï¼Œè¿™å¯æ˜¯é»‘é™¶è´¨æ„Ÿçš„å‘é¥°ã€‚", "å“å‘€ï¼Œæ‘¸å¤´é•¿ä¸é«˜çš„ï¼"],
        mouth: ["æƒ³å°å°ç« ä¸˜çš„è¾›å¯¨è‚˜å­å—ã€‚", "å¥½æƒ³å°å°ç« ä¸˜çš„å¤§è‘±å‘€~"],
        hand_right: ["è¢–å£é‡Œè®°å½•ç€ç« ä¸˜çš„å†å²ã€‚", "ç™¾è„‰æ³‰çš„æ°´çœŸæ¸…å‡‰ã€‚"],
        arm_left: ["çŸ¥å¦ï¼ŒçŸ¥å¦ï¼Œåº”æ˜¯ç»¿è‚¥çº¢ç˜¦â€¦â€¦ä½ ä¹Ÿæƒ³æ¥æ˜æ°´å¤åŸï¼Œä¸æˆ‘å…±å¡«ä¸€é˜•æ–°è¯å—ï¼Ÿ","å·¦è¢–é‡Œè—ç€å…¨æ¯æŠ•å½±è®¾å¤‡ã€‚"],
        body: ["è¿™èº«è¡£æœæ˜¯é‡‡é›†äº†ç™¾è„‰æ³‰çš„æ³¢å…‰æ•°æ®ç»‡æˆçš„ï¼Œæ˜¯ä¸æ˜¯æ¯”ä¼ ç»Ÿçš„ä¸ç»¸æ›´é…·ï¼Ÿ", "è¿™æ˜¯æœ€æ–°çš„é˜²æ°´å¸ƒæ–™ã€‚", "ä½ ä¹Ÿé¥¿äº†å—ï¼Ÿ"]
    };

    function interact(part) {
        const textList = scripts[part];
        const text = textList[Math.floor(Math.random() * textList.length)];
        showBubble(text);
        speak(text);
        modelViewer.style.transform = "scale(1.05)";
        setTimeout(() => { modelViewer.style.transform = "scale(1)"; }, 200);
    }

    function showBubble(text) {
        dialogBox.innerText = text;
        dialogBox.style.display = 'block';
        if (hideTimer) clearTimeout(hideTimer);
        hideTimer = setTimeout(() => { dialogBox.style.display = 'none'; }, 3000);
    }

    function speak(text) {
        if ('speechSynthesis' in window) {
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(text);
            u.lang = 'zh-CN'; u.rate = 1.3; u.pitch = 1.4;
            window.speechSynthesis.speak(u);
        }
    }

    // --- æ–°ç‰ˆæ‰“æ‹›å‘¼ï¼šåŸºäº BASE_ANGLE æ‘‡æ‘† ---
    function sayHello() {
        const t = "å„ä½è¯„å§”è€å¸ˆå¥½ï¼Œæˆ‘æ˜¯èµ›åšæ˜“å®‰ï¼";
        showBubble(t);
        speak(t);
        
        // å…ˆå‘å³æ‘† (åŸºå‡† + 30åº¦)
        modelViewer.cameraOrbit = `${BASE_ANGLE + 30}deg 75deg 105%`;
        
        setTimeout(() => {
            // å†å‘å·¦æ‘† (åŸºå‡† - 30åº¦)
            modelViewer.cameraOrbit = `${BASE_ANGLE - 30}deg 75deg 105%`;
            
            setTimeout(() => {
                // å›æ­£ (å›åˆ°åŸºå‡†)
                modelViewer.cameraOrbit = `${BASE_ANGLE}deg 75deg 105%`;
            }, 600);
        }, 600);
    }

    // --- æ¾æ‰‹è‡ªåŠ¨å›æ­£ (æ ¸å¿ƒä¿®å¤) ---
    ['mouseup', 'touchend'].forEach(evt => {
        document.addEventListener(evt, () => {
            setTimeout(() => {
                // å…³é”®ä¿®å¤ï¼šå›åˆ° BASE_ANGLEï¼Œè€Œä¸æ˜¯ 0deg
                modelViewer.cameraOrbit = `${BASE_ANGLE}deg 75deg 105%`;
            }, 100);
        });
    });

</script>

</body>
</html>
